---
type Faq = { q: string; a: string };
const { items = [] } = Astro.props as { items: Faq[] };
---

<div class="space-y-3" data-faq-accordion>
  {items.map((item, idx) => (
    <article class="faq-item card-base" data-faq-item>
      <button class="faq-trigger" type="button" aria-expanded={idx === 0 ? "true" : "false"} data-faq-trigger>
        <span class="font-medium text-slate-900">{item.q}</span>
        <span class="faq-icon" aria-hidden="true">+</span>
      </button>
      <div class={`faq-panel ${idx === 0 ? "is-open" : ""}`} data-faq-panel>
        <p class="faq-panel-inner text-sm leading-6 text-slate-600">{item.a}</p>
      </div>
    </article>
  ))}
</div>

<script is:inline>
  const accordions = document.querySelectorAll("[data-faq-accordion]");

  accordions.forEach((accordion) => {
    const items = accordion.querySelectorAll("[data-faq-item]");

    items.forEach((item) => {
      const trigger = item.querySelector("[data-faq-trigger]");
      const panel = item.querySelector("[data-faq-panel]");
      if (!trigger || !panel) return;

      const setPanelHeight = (open) => {
        if (open) {
          panel.classList.add("is-open");
          panel.style.maxHeight = `${panel.scrollHeight}px`;
        } else {
          panel.style.maxHeight = `${panel.scrollHeight}px`;
          requestAnimationFrame(() => {
            panel.style.maxHeight = "0px";
            panel.classList.remove("is-open");
          });
        }
      };

      if (trigger.getAttribute("aria-expanded") === "true") {
        panel.style.maxHeight = `${panel.scrollHeight}px`;
      }

      trigger.addEventListener("click", () => {
        const isOpen = trigger.getAttribute("aria-expanded") === "true";
        trigger.setAttribute("aria-expanded", String(!isOpen));
        setPanelHeight(!isOpen);
      });
    });
  });
</script>
