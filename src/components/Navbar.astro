---
import { site, getWhatsAppUrl } from "../data/site";

const links = [
  { href: "/", label: "Home" },
  { href: "/servizi", label: "Servizi" },
  { href: "/chi-siamo", label: "Chi siamo" },
  { href: "/casi-studio", label: "Casi studio" },
  { href: "/certificazioni", label: "Certificazioni" },
  { href: "/customer-care", label: "Customer care" },
  { href: "/contatti", label: "Contatti" },
];
const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-40 border-b border-[color:var(--border)] bg-white/88 backdrop-blur-sm">
  <div class="site-container">
    <div class="flex items-center justify-between gap-3 py-3.5">
      <a href="/" class="flex items-center gap-3 rounded-md pr-2">
        <div class="grid h-10 w-10 place-items-center rounded-[var(--radius-md)] bg-[color:var(--accent)] text-sm font-bold text-white">
          G
        </div>
        <div>
          <div class="text-sm font-semibold leading-tight text-slate-900">{site.companyName}</div>
          <div class="text-xs leading-tight text-slate-500">Impresa di pulizie</div>
        </div>
      </a>

      <nav class="hidden items-center gap-1 lg:flex">
        {links.map((link) => (
          <a
            href={link.href}
            class={`btn min-h-10 px-3 text-sm font-medium ${
              currentPath === link.href || (link.href !== "/" && currentPath.startsWith(link.href))
                ? "bg-slate-900 text-white"
                : "btn-ghost text-slate-700"
            }`}
          >
            {link.label}
          </a>
        ))}
      </nav>

      <div class="hidden items-center gap-2 lg:flex">
        <a href={`tel:${site.phoneHref}`} class="btn btn-secondary" data-track="click_phone">Chiama</a>
        <a
          href={getWhatsAppUrl()}
          target="_blank"
          rel="noopener"
          class="btn bg-green-600 text-white hover:brightness-105"
          data-track="click_whatsapp"
        >
          WhatsApp
        </a>
      </div>

      <button
        id="menu-toggle"
        class="grid h-10 w-10 place-items-center rounded-[var(--radius-md)] border border-[color:var(--border)] bg-white text-slate-700 lg:hidden"
        aria-expanded="false"
        aria-controls="mobile-menu"
        aria-label="Apri menu"
      >
        <span class="text-lg">â˜°</span>
      </button>
    </div>
  </div>

  <div id="mobile-menu" class="hidden border-t border-[color:var(--border)] bg-white lg:hidden">
    <div class="site-container py-3">
      <nav class="flex flex-col gap-1.5">
        {links.map((link) => (
          <a
            href={link.href}
            class={`btn justify-start px-3 text-sm ${
              currentPath === link.href || (link.href !== "/" && currentPath.startsWith(link.href))
                ? "bg-slate-900 text-white"
                : "btn-ghost text-slate-700"
            }`}
          >
            {link.label}
          </a>
        ))}
      </nav>
      <div class="mt-3 grid grid-cols-2 gap-2">
        <a href={`tel:${site.phoneHref}`} class="btn btn-secondary" data-track="click_phone">Chiama</a>
        <a
          href={getWhatsAppUrl()}
          target="_blank"
          rel="noopener"
          class="btn bg-green-600 text-white hover:brightness-105"
          data-track="click_whatsapp"
        >
          WhatsApp
        </a>
      </div>
    </div>
  </div>
</header>

<script is:inline>
  const btn = document.getElementById("menu-toggle");
  const menu = document.getElementById("mobile-menu");

  if (btn && menu) {
    btn.addEventListener("click", () => {
      const isOpen = !menu.classList.contains("hidden");
      menu.classList.toggle("hidden");
      btn.setAttribute("aria-expanded", String(!isOpen));
    });
  }
</script>
