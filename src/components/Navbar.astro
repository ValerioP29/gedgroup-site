---
import { site, getWhatsAppUrl } from "../data/site";

const links = [
  { href: "/", label: "Home" },
  { href: "/servizi", label: "Servizi" },
  { href: "/chi-siamo", label: "Chi siamo" },
  { href: "/casi-studio", label: "Casi studio" },
  { href: "/certificazioni", label: "Certificazioni" },
  { href: "/customer-care", label: "Customer care" },
  { href: "/contatti", label: "Contatti" },
];
const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-40 border-b border-black/5 bg-white/85 backdrop-blur">
  <div class="mx-auto flex max-w-7xl items-center justify-between gap-3 px-4 py-3">
    <a href="/" class="flex items-center gap-3">
      <div class="grid h-10 w-10 place-items-center rounded-xl bg-neutral-900 text-white font-bold">
        G
      </div>
      <div>
        <div class="text-sm font-semibold leading-tight">{site.companyName}</div>
        <div class="text-xs text-neutral-500 leading-tight">Impresa di pulizie</div>
      </div>
    </a>

    <nav class="hidden items-center gap-1 lg:flex">
      {links.map((link) => (
        <a
          href={link.href}
          class={`rounded-xl px-3 py-2 text-sm transition ${
            currentPath === link.href || (link.href !== "/" && currentPath.startsWith(link.href))
              ? "bg-neutral-900 text-white"
              : "text-neutral-700 hover:bg-neutral-100"
          }`}
        >
          {link.label}
        </a>
      ))}
    </nav>

    <div class="hidden items-center gap-2 lg:flex">
      <a
        href={`tel:${site.phoneHref}`}
        class="rounded-xl border border-neutral-300 px-3 py-2 text-sm hover:bg-neutral-50"
        data-track="click_phone"
      >
        Chiama
      </a>
      <a
        href={getWhatsAppUrl()}
        target="_blank"
        rel="noopener"
        class="rounded-xl bg-green-600 px-3 py-2 text-sm font-medium text-white hover:bg-green-700"
        data-track="click_whatsapp"
      >
        WhatsApp
      </a>
    </div>

    <button
      id="menu-toggle"
      class="grid h-10 w-10 place-items-center rounded-xl border border-neutral-300 lg:hidden"
      aria-expanded="false"
      aria-controls="mobile-menu"
      aria-label="Apri menu"
    >
      <span class="text-lg">â˜°</span>
    </button>
  </div>

  <div id="mobile-menu" class="hidden border-t border-black/5 bg-white lg:hidden">
    <div class="mx-auto max-w-7xl px-4 py-3">
      <nav class="flex flex-col gap-1">
        {links.map((link) => (
          <a
            href={link.href}
            class={`rounded-lg px-3 py-2 text-sm ${
              currentPath === link.href || (link.href !== "/" && currentPath.startsWith(link.href))
                ? "bg-neutral-900 text-white"
                : "text-neutral-700 hover:bg-neutral-100"
            }`}
          >
            {link.label}
          </a>
        ))}
      </nav>
      <div class="mt-3 grid grid-cols-2 gap-2">
        <a
          href={`tel:${site.phoneHref}`}
          class="rounded-lg border border-neutral-300 px-3 py-2 text-center text-sm hover:bg-neutral-50"
          data-track="click_phone"
        >
          Chiama
        </a>
        <a
          href={getWhatsAppUrl()}
          target="_blank"
          rel="noopener"
          class="rounded-lg bg-green-600 px-3 py-2 text-center text-sm font-medium text-white hover:bg-green-700"
          data-track="click_whatsapp"
        >
          WhatsApp
        </a>
      </div>
    </div>
  </div>
</header>

<script is:inline>
  const btn = document.getElementById("menu-toggle");
  const menu = document.getElementById("mobile-menu");

  if (btn && menu) {
    btn.addEventListener("click", () => {
      const isOpen = !menu.classList.contains("hidden");
      menu.classList.toggle("hidden");
      btn.setAttribute("aria-expanded", String(!isOpen));
    });
  }
</script>