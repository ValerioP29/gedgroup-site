---
import type { ServiceItem } from "../data/services";

const { services = [] } = Astro.props as { services: ServiceItem[] };
const featured = services.slice(0, 3);
---

{featured.length > 0 && (
  <section class="section-y" data-reveal="auto">
    <div class="site-container">
      <div class="panel service-chooser" data-service-chooser>
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.14em] text-slate-500">Service chooser</p>
          <h2 class="mt-2">Scegli il contesto e guarda un piano tipo</h2>
        </div>

        <div class="service-chooser__tabs" role="tablist" aria-label="Seleziona settore servizio">
          {featured.map((service, idx) => (
            <button type="button" class={`service-chooser__tab ${idx === 0 ? "is-active" : ""}`} role="tab" aria-selected={idx === 0 ? "true" : "false"} data-service-tab data-service-target={service.slug}>
              {service.title}
            </button>
          ))}
        </div>

        <div class="service-chooser__stage">
          {featured.map((service, idx) => (
            <article class={`service-chooser__panel ${idx === 0 ? "is-active" : ""}`} data-service-panel={service.slug}>
              <figure class="service-chooser__media-wrap">
                <img src={service.heroImage.src} alt={service.heroImage.alt} class="service-chooser__media" loading="lazy" decoding="async" />
              </figure>
              <div class="service-chooser__content">
                <p class="pill-soft inline-flex rounded-full px-3 py-1 text-xs font-semibold">{service.heroLabel}</p>
                <p class="mt-3 text-sm leading-7 text-slate-600">{service.summary}</p>
                <ul class="mt-4 grid gap-2 text-sm text-slate-700">
                  {service.serviceOutputs.slice(0, 3).map((item) => (
                    <li class="service-chooser__bullet">{item}</li>
                  ))}
                </ul>
                <a href={`/servizi/${service.slug}`} class="btn btn-primary mt-5">Approfondisci il servizio</a>
              </div>
            </article>
          ))}
        </div>
      </div>
    </div>
  </section>
)}

<script is:inline>
  const chooserRoots = document.querySelectorAll("[data-service-chooser]");

  chooserRoots.forEach((root) => {
    const tabs = root.querySelectorAll("[data-service-tab]");
    const panels = root.querySelectorAll("[data-service-panel]");
    if (!tabs.length || !panels.length) return;

    const activate = (slug) => {
      tabs.forEach((tab) => {
        const active = tab.getAttribute("data-service-target") === slug;
        tab.classList.toggle("is-active", active);
        tab.setAttribute("aria-selected", String(active));
      });
      panels.forEach((panel) => {
        const active = panel.getAttribute("data-service-panel") === slug;
        panel.classList.toggle("is-active", active);
      });
    };

    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        const slug = tab.getAttribute("data-service-target");
        if (slug) activate(slug);
      });
    });
  });
</script>
