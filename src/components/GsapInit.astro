<script>
  import { cleanupMotion, initMotionSystem } from "../lib/motion";

  let teardown = () => {};

  const start = () => {
    teardown();
    cleanupMotion();
    teardown = initMotionSystem(document);
  };

  const stop = () => {
    teardown();
    teardown = () => {};
    cleanupMotion();
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", start, { once: true });
  } else {
    start();
  }

  document.addEventListener("astro:before-preparation", stop);
  document.addEventListener("astro:page-load", start);
</script>
